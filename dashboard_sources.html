<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Source Comparison Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link rel="stylesheet" href="templates/base.css">
</head>
<body>
    <nav class="nav">
    <a href="dashboard.html" id="nav-overview">üìä Overview</a>
    <a href="dashboard_compare.html" id="nav-compare">üìà Month Comparison</a>
    <a href="dashboard_sources.html" id="nav-sources">üè™ Source Comparison</a>
</nav>
<script>
    // Highlight current page in nav
    const currentPage = window.location.pathname.split('/').pop();
    document.querySelectorAll('.nav a').forEach(link => {
        if (link.getAttribute('href') === currentPage) {
            link.classList.add('active');
        }
    });
</script>


    
    <div class="header">
        <h1>üè™ Multi-Source Comparison Dashboard</h1>
        <p>Compare performance across different sales channels</p>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label>Select Month</label>
            <select id="monthSelector" onchange="updateDashboard()"></select>
        </div>
        <div class="control-group">
            <label>Compare Sources</label>
            <div class="source-chips" id="sourceChips"></div>
        </div>
        <div class="control-group">
            <label>&nbsp;</label>
            <button onclick="selectAllSources()">Select All</button>
        </div>
    </div>
    
    <div class="metrics-grid" id="summaryGrid"></div>
    
    <div class="charts-grid">
        <div class="chart-card">
            <h3>üìà Orders by Source Over Time</h3>
            <div id="trendChart"></div>
        </div>
        <div class="chart-card">
            <h3>üìä Source Comparison (Selected Month)</h3>
            <div id="comparisonChart"></div>
        </div>
    </div>
    
    <h3 style="padding: 20px 40px 10px; color: #fff;">üìã Detailed Comparison</h3>
    <table class="comparison-table" id="comparisonTable">
        <thead><tr><th>Metric</th></tr></thead>
        <tbody></tbody>
    </table>

    <script>
        const metricsData = [{"Source": "Aeon Long Bi\u00ean", "Year": 2025, "Month": 5, "total_orders": 60, "delivered": 52, "cancelled": 0, "returned": 0, "failed": 8, "delivery_rate": 86.7, "cancel_rate": 0.0}, {"Source": "Aeon Long Bi\u00ean", "Year": 2025, "Month": 6, "total_orders": 768, "delivered": 664, "cancelled": 12, "returned": 0, "failed": 88, "delivery_rate": 86.5, "cancel_rate": 1.6}, {"Source": "Aeon Long Bi\u00ean", "Year": 2025, "Month": 7, "total_orders": 1152, "delivered": 800, "cancelled": 48, "returned": 28, "failed": 148, "delivery_rate": 69.4, "cancel_rate": 4.2}, {"Source": "Aeon Long Bi\u00ean", "Year": 2025, "Month": 8, "total_orders": 1120, "delivered": 764, "cancelled": 40, "returned": 28, "failed": 152, "delivery_rate": 68.2, "cancel_rate": 3.6}, {"Source": "Aeon Long Bi\u00ean", "Year": 2025, "Month": 9, "total_orders": 1556, "delivered": 972, "cancelled": 120, "returned": 48, "failed": 212, "delivery_rate": 62.5, "cancel_rate": 7.7}, {"Source": "Aeon Long Bi\u00ean", "Year": 2025, "Month": 10, "total_orders": 1572, "delivered": 1156, "cancelled": 64, "returned": 28, "failed": 252, "delivery_rate": 73.5, "cancel_rate": 4.1}, {"Source": "Aeon Long Bi\u00ean", "Year": 2025, "Month": 11, "total_orders": 2096, "delivered": 1436, "cancelled": 160, "returned": 36, "failed": 284, "delivery_rate": 68.5, "cancel_rate": 7.6}, {"Source": "Colum", "Year": 2025, "Month": 5, "total_orders": 88, "delivered": 50, "cancelled": 30, "returned": 2, "failed": 6, "delivery_rate": 56.8, "cancel_rate": 34.1}, {"Source": "Colum", "Year": 2025, "Month": 6, "total_orders": 110, "delivered": 90, "cancelled": 6, "returned": 0, "failed": 14, "delivery_rate": 81.8, "cancel_rate": 5.5}, {"Source": "Colum", "Year": 2025, "Month": 7, "total_orders": 350, "delivered": 266, "cancelled": 18, "returned": 12, "failed": 54, "delivery_rate": 76.0, "cancel_rate": 5.1}, {"Source": "Colum", "Year": 2025, "Month": 8, "total_orders": 414, "delivered": 350, "cancelled": 4, "returned": 18, "failed": 42, "delivery_rate": 84.5, "cancel_rate": 1.0}, {"Source": "Colum", "Year": 2025, "Month": 9, "total_orders": 700, "delivered": 560, "cancelled": 36, "returned": 16, "failed": 88, "delivery_rate": 80.0, "cancel_rate": 5.1}, {"Source": "Colum", "Year": 2025, "Month": 10, "total_orders": 666, "delivered": 506, "cancelled": 50, "returned": 42, "failed": 68, "delivery_rate": 76.0, "cancel_rate": 7.5}, {"Source": "Colum", "Year": 2025, "Month": 11, "total_orders": 724, "delivered": 520, "cancelled": 46, "returned": 34, "failed": 64, "delivery_rate": 71.8, "cancel_rate": 6.4}, {"Source": "Crescent Mall", "Year": 2025, "Month": 3, "total_orders": 952, "delivered": 608, "cancelled": 20, "returned": 16, "failed": 88, "delivery_rate": 63.9, "cancel_rate": 2.1}, {"Source": "Crescent Mall", "Year": 2025, "Month": 4, "total_orders": 3928, "delivered": 2364, "cancelled": 128, "returned": 100, "failed": 376, "delivery_rate": 60.2, "cancel_rate": 3.3}, {"Source": "Crescent Mall", "Year": 2025, "Month": 5, "total_orders": 3808, "delivered": 2712, "cancelled": 148, "returned": 116, "failed": 396, "delivery_rate": 71.2, "cancel_rate": 3.9}, {"Source": "Crescent Mall", "Year": 2025, "Month": 6, "total_orders": 2052, "delivered": 1756, "cancelled": 64, "returned": 0, "failed": 224, "delivery_rate": 85.6, "cancel_rate": 3.1}, {"Source": "Crescent Mall", "Year": 2025, "Month": 7, "total_orders": 4240, "delivered": 2724, "cancelled": 212, "returned": 188, "failed": 396, "delivery_rate": 64.2, "cancel_rate": 5.0}, {"Source": "Crescent Mall", "Year": 2025, "Month": 8, "total_orders": 2144, "delivered": 1340, "cancelled": 220, "returned": 48, "failed": 212, "delivery_rate": 62.5, "cancel_rate": 10.3}, {"Source": "Crescent Mall", "Year": 2025, "Month": 9, "total_orders": 3260, "delivered": 1988, "cancelled": 260, "returned": 112, "failed": 372, "delivery_rate": 61.0, "cancel_rate": 8.0}, {"Source": "Crescent Mall", "Year": 2025, "Month": 10, "total_orders": 2388, "delivered": 1336, "cancelled": 156, "returned": 60, "failed": 252, "delivery_rate": 55.9, "cancel_rate": 6.5}, {"Source": "Crescent Mall", "Year": 2025, "Month": 11, "total_orders": 3480, "delivered": 1896, "cancelled": 284, "returned": 92, "failed": 364, "delivery_rate": 54.5, "cancel_rate": 8.2}, {"Source": "Estella", "Year": 2025, "Month": 5, "total_orders": 324, "delivered": 268, "cancelled": 12, "returned": 8, "failed": 24, "delivery_rate": 82.7, "cancel_rate": 3.7}, {"Source": "Estella", "Year": 2025, "Month": 6, "total_orders": 2368, "delivered": 2032, "cancelled": 68, "returned": 0, "failed": 264, "delivery_rate": 85.8, "cancel_rate": 2.9}, {"Source": "Estella", "Year": 2025, "Month": 7, "total_orders": 3356, "delivered": 2328, "cancelled": 128, "returned": 116, "failed": 380, "delivery_rate": 69.4, "cancel_rate": 3.8}, {"Source": "Estella", "Year": 2025, "Month": 8, "total_orders": 1936, "delivered": 1308, "cancelled": 60, "returned": 40, "failed": 288, "delivery_rate": 67.6, "cancel_rate": 3.1}, {"Source": "Estella", "Year": 2025, "Month": 9, "total_orders": 2160, "delivered": 1464, "cancelled": 140, "returned": 76, "failed": 276, "delivery_rate": 67.8, "cancel_rate": 6.5}, {"Source": "Estella", "Year": 2025, "Month": 10, "total_orders": 2396, "delivered": 1592, "cancelled": 184, "returned": 64, "failed": 212, "delivery_rate": 66.4, "cancel_rate": 7.7}, {"Source": "Estella", "Year": 2025, "Month": 11, "total_orders": 2244, "delivered": 1360, "cancelled": 176, "returned": 44, "failed": 272, "delivery_rate": 60.6, "cancel_rate": 7.8}, {"Source": "GO! Da Nang", "Year": 2025, "Month": 5, "total_orders": 180, "delivered": 116, "cancelled": 12, "returned": 4, "failed": 24, "delivery_rate": 64.4, "cancel_rate": 6.7}, {"Source": "GO! Da Nang", "Year": 2025, "Month": 6, "total_orders": 480, "delivered": 420, "cancelled": 12, "returned": 0, "failed": 48, "delivery_rate": 87.5, "cancel_rate": 2.5}, {"Source": "GO! Da Nang", "Year": 2025, "Month": 7, "total_orders": 824, "delivered": 580, "cancelled": 36, "returned": 44, "failed": 96, "delivery_rate": 70.4, "cancel_rate": 4.4}, {"Source": "GO! Da Nang", "Year": 2025, "Month": 8, "total_orders": 580, "delivered": 412, "cancelled": 44, "returned": 12, "failed": 32, "delivery_rate": 71.0, "cancel_rate": 7.6}, {"Source": "GO! Da Nang", "Year": 2025, "Month": 9, "total_orders": 576, "delivered": 404, "cancelled": 24, "returned": 12, "failed": 68, "delivery_rate": 70.1, "cancel_rate": 4.2}, {"Source": "GO! Da Nang", "Year": 2025, "Month": 10, "total_orders": 564, "delivered": 392, "cancelled": 12, "returned": 32, "failed": 88, "delivery_rate": 69.5, "cancel_rate": 2.1}, {"Source": "GO! Da Nang", "Year": 2025, "Month": 11, "total_orders": 748, "delivered": 556, "cancelled": 40, "returned": 32, "failed": 72, "delivery_rate": 74.3, "cancel_rate": 5.3}, {"Source": "Le Van Sy", "Year": 2025, "Month": 7, "total_orders": 968, "delivered": 780, "cancelled": 36, "returned": 44, "failed": 92, "delivery_rate": 80.6, "cancel_rate": 3.7}, {"Source": "Le Van Sy", "Year": 2025, "Month": 8, "total_orders": 2684, "delivered": 2148, "cancelled": 80, "returned": 96, "failed": 308, "delivery_rate": 80.0, "cancel_rate": 3.0}, {"Source": "Le Van Sy", "Year": 2025, "Month": 9, "total_orders": 2156, "delivered": 1712, "cancelled": 84, "returned": 112, "failed": 216, "delivery_rate": 79.4, "cancel_rate": 3.9}, {"Source": "Le Van Sy", "Year": 2025, "Month": 10, "total_orders": 3600, "delivered": 2704, "cancelled": 260, "returned": 164, "failed": 384, "delivery_rate": 75.1, "cancel_rate": 7.2}, {"Source": "Le Van Sy", "Year": 2025, "Month": 11, "total_orders": 4140, "delivered": 3056, "cancelled": 300, "returned": 140, "failed": 512, "delivery_rate": 73.8, "cancel_rate": 7.2}, {"Source": "Lotte Mall", "Year": 2025, "Month": 5, "total_orders": 396, "delivered": 292, "cancelled": 12, "returned": 28, "failed": 24, "delivery_rate": 73.7, "cancel_rate": 3.0}, {"Source": "Lotte Mall", "Year": 2025, "Month": 6, "total_orders": 1648, "delivered": 1340, "cancelled": 64, "returned": 4, "failed": 232, "delivery_rate": 81.3, "cancel_rate": 3.9}, {"Source": "Lotte Mall", "Year": 2025, "Month": 7, "total_orders": 2052, "delivered": 1116, "cancelled": 96, "returned": 72, "failed": 188, "delivery_rate": 54.4, "cancel_rate": 4.7}, {"Source": "Lotte Mall", "Year": 2025, "Month": 8, "total_orders": 732, "delivered": 416, "cancelled": 44, "returned": 28, "failed": 92, "delivery_rate": 56.8, "cancel_rate": 6.0}, {"Source": "Lotte Mall", "Year": 2025, "Month": 9, "total_orders": 684, "delivered": 480, "cancelled": 92, "returned": 8, "failed": 92, "delivery_rate": 70.2, "cancel_rate": 13.5}, {"Source": "Lotte Mall", "Year": 2025, "Month": 10, "total_orders": 1368, "delivered": 840, "cancelled": 232, "returned": 44, "failed": 124, "delivery_rate": 61.4, "cancel_rate": 17.0}, {"Source": "Lotte Mall", "Year": 2025, "Month": 11, "total_orders": 2900, "delivered": 1652, "cancelled": 472, "returned": 124, "failed": 304, "delivery_rate": 57.0, "cancel_rate": 16.3}, {"Source": "Shopee", "Year": 2024, "Month": 1, "total_orders": 8742, "delivered": 5726, "cancelled": 2508, "returned": 246, "failed": 262, "delivery_rate": 65.5, "cancel_rate": 28.7}, {"Source": "Shopee", "Year": 2024, "Month": 2, "total_orders": 5988, "delivered": 4042, "cancelled": 1562, "returned": 170, "failed": 214, "delivery_rate": 67.5, "cancel_rate": 26.1}, {"Source": "Shopee", "Year": 2024, "Month": 3, "total_orders": 11846, "delivered": 7460, "cancelled": 3602, "returned": 526, "failed": 258, "delivery_rate": 63.0, "cancel_rate": 30.4}, {"Source": "Shopee", "Year": 2024, "Month": 4, "total_orders": 13540, "delivered": 8446, "cancelled": 4008, "returned": 730, "failed": 356, "delivery_rate": 62.4, "cancel_rate": 29.6}, {"Source": "Shopee", "Year": 2024, "Month": 5, "total_orders": 27816, "delivered": 17630, "cancelled": 8050, "returned": 1502, "failed": 634, "delivery_rate": 63.4, "cancel_rate": 28.9}, {"Source": "Shopee", "Year": 2024, "Month": 6, "total_orders": 23852, "delivered": 14742, "cancelled": 6928, "returned": 1608, "failed": 574, "delivery_rate": 61.8, "cancel_rate": 29.0}, {"Source": "Shopee", "Year": 2024, "Month": 7, "total_orders": 26066, "delivered": 16506, "cancelled": 7050, "returned": 1802, "failed": 708, "delivery_rate": 63.3, "cancel_rate": 27.0}, {"Source": "Shopee", "Year": 2024, "Month": 8, "total_orders": 28700, "delivered": 19890, "cancelled": 7820, "returned": 328, "failed": 662, "delivery_rate": 69.3, "cancel_rate": 27.2}, {"Source": "Shopee", "Year": 2024, "Month": 9, "total_orders": 33226, "delivered": 22410, "cancelled": 9672, "returned": 410, "failed": 734, "delivery_rate": 67.4, "cancel_rate": 29.1}, {"Source": "Shopee", "Year": 2024, "Month": 10, "total_orders": 24328, "delivered": 15564, "cancelled": 6548, "returned": 1640, "failed": 576, "delivery_rate": 64.0, "cancel_rate": 26.9}, {"Source": "Shopee", "Year": 2024, "Month": 11, "total_orders": 30890, "delivered": 18898, "cancelled": 8526, "returned": 3426, "failed": 40, "delivery_rate": 61.2, "cancel_rate": 27.6}, {"Source": "Shopee", "Year": 2024, "Month": 12, "total_orders": 22220, "delivered": 13776, "cancelled": 6138, "returned": 2272, "failed": 34, "delivery_rate": 62.0, "cancel_rate": 27.6}, {"Source": "Shopee", "Year": 2025, "Month": 1, "total_orders": 16512, "delivered": 10560, "cancelled": 4542, "returned": 1050, "failed": 360, "delivery_rate": 64.0, "cancel_rate": 27.5}, {"Source": "Shopee", "Year": 2025, "Month": 2, "total_orders": 14756, "delivered": 9572, "cancelled": 4074, "returned": 780, "failed": 330, "delivery_rate": 64.9, "cancel_rate": 27.6}, {"Source": "Shopee", "Year": 2025, "Month": 3, "total_orders": 17424, "delivered": 11222, "cancelled": 4934, "returned": 1000, "failed": 268, "delivery_rate": 64.4, "cancel_rate": 28.3}, {"Source": "Shopee", "Year": 2025, "Month": 4, "total_orders": 18968, "delivered": 12148, "cancelled": 5250, "returned": 1182, "failed": 388, "delivery_rate": 64.0, "cancel_rate": 27.7}, {"Source": "Shopee", "Year": 2025, "Month": 5, "total_orders": 29252, "delivered": 18416, "cancelled": 8532, "returned": 1704, "failed": 600, "delivery_rate": 63.0, "cancel_rate": 29.2}, {"Source": "Shopee", "Year": 2025, "Month": 6, "total_orders": 37554, "delivered": 23952, "cancelled": 10098, "returned": 2758, "failed": 746, "delivery_rate": 63.8, "cancel_rate": 26.9}, {"Source": "Shopee", "Year": 2025, "Month": 7, "total_orders": 35396, "delivered": 23056, "cancelled": 8892, "returned": 2818, "failed": 630, "delivery_rate": 65.1, "cancel_rate": 25.1}, {"Source": "Shopee", "Year": 2025, "Month": 8, "total_orders": 29616, "delivered": 19388, "cancelled": 7426, "returned": 2214, "failed": 588, "delivery_rate": 65.5, "cancel_rate": 25.1}, {"Source": "Shopee", "Year": 2025, "Month": 9, "total_orders": 28762, "delivered": 17648, "cancelled": 8064, "returned": 2522, "failed": 528, "delivery_rate": 61.4, "cancel_rate": 28.0}, {"Source": "Shopee", "Year": 2025, "Month": 10, "total_orders": 30016, "delivered": 18454, "cancelled": 8568, "returned": 2446, "failed": 548, "delivery_rate": 61.5, "cancel_rate": 28.5}, {"Source": "Shopee", "Year": 2025, "Month": 11, "total_orders": 44298, "delivered": 25962, "cancelled": 13060, "returned": 2958, "failed": 596, "delivery_rate": 58.6, "cancel_rate": 29.5}, {"Source": "Warehouse", "Year": 2024, "Month": 1, "total_orders": 11368, "delivered": 9050, "cancelled": 808, "returned": 582, "failed": 928, "delivery_rate": 79.6, "cancel_rate": 7.1}, {"Source": "Warehouse", "Year": 2024, "Month": 2, "total_orders": 8446, "delivered": 6626, "cancelled": 548, "returned": 390, "failed": 882, "delivery_rate": 78.5, "cancel_rate": 6.5}, {"Source": "Warehouse", "Year": 2024, "Month": 3, "total_orders": 11872, "delivered": 9466, "cancelled": 762, "returned": 668, "failed": 976, "delivery_rate": 79.7, "cancel_rate": 6.4}, {"Source": "Warehouse", "Year": 2024, "Month": 4, "total_orders": 14960, "delivered": 12274, "cancelled": 612, "returned": 852, "failed": 1222, "delivery_rate": 82.0, "cancel_rate": 4.1}, {"Source": "Warehouse", "Year": 2024, "Month": 5, "total_orders": 13784, "delivered": 11320, "cancelled": 590, "returned": 804, "failed": 1070, "delivery_rate": 82.1, "cancel_rate": 4.3}, {"Source": "Warehouse", "Year": 2024, "Month": 6, "total_orders": 16400, "delivered": 13482, "cancelled": 634, "returned": 810, "failed": 1474, "delivery_rate": 82.2, "cancel_rate": 3.9}, {"Source": "Warehouse", "Year": 2024, "Month": 7, "total_orders": 14562, "delivered": 11862, "cancelled": 1024, "returned": 584, "failed": 1092, "delivery_rate": 81.5, "cancel_rate": 7.0}, {"Source": "Warehouse", "Year": 2024, "Month": 8, "total_orders": 14224, "delivered": 11366, "cancelled": 1160, "returned": 694, "failed": 1004, "delivery_rate": 79.9, "cancel_rate": 8.2}, {"Source": "Warehouse", "Year": 2024, "Month": 9, "total_orders": 14960, "delivered": 11924, "cancelled": 1178, "returned": 750, "failed": 1108, "delivery_rate": 79.7, "cancel_rate": 7.9}, {"Source": "Warehouse", "Year": 2024, "Month": 10, "total_orders": 14142, "delivered": 11858, "cancelled": 918, "returned": 776, "failed": 580, "delivery_rate": 83.8, "cancel_rate": 6.5}, {"Source": "Warehouse", "Year": 2024, "Month": 11, "total_orders": 17030, "delivered": 13820, "cancelled": 1094, "returned": 966, "failed": 1150, "delivery_rate": 81.2, "cancel_rate": 6.4}, {"Source": "Warehouse", "Year": 2024, "Month": 12, "total_orders": 13952, "delivered": 11248, "cancelled": 930, "returned": 724, "failed": 1050, "delivery_rate": 80.6, "cancel_rate": 6.7}, {"Source": "Warehouse", "Year": 2025, "Month": 1, "total_orders": 12090, "delivered": 9424, "cancelled": 1032, "returned": 626, "failed": 1008, "delivery_rate": 77.9, "cancel_rate": 8.5}, {"Source": "Warehouse", "Year": 2025, "Month": 2, "total_orders": 11214, "delivered": 8912, "cancelled": 822, "returned": 608, "failed": 872, "delivery_rate": 79.5, "cancel_rate": 7.3}, {"Source": "Warehouse", "Year": 2025, "Month": 3, "total_orders": 13128, "delivered": 10280, "cancelled": 936, "returned": 762, "failed": 1150, "delivery_rate": 78.3, "cancel_rate": 7.1}, {"Source": "Warehouse", "Year": 2025, "Month": 4, "total_orders": 11640, "delivered": 9158, "cancelled": 1024, "returned": 602, "failed": 856, "delivery_rate": 78.7, "cancel_rate": 8.8}, {"Source": "Warehouse", "Year": 2025, "Month": 5, "total_orders": 11568, "delivered": 9476, "cancelled": 476, "returned": 596, "failed": 1020, "delivery_rate": 81.9, "cancel_rate": 4.1}, {"Source": "Warehouse", "Year": 2025, "Month": 6, "total_orders": 9684, "delivered": 7772, "cancelled": 680, "returned": 488, "failed": 744, "delivery_rate": 80.3, "cancel_rate": 7.0}, {"Source": "Warehouse", "Year": 2025, "Month": 7, "total_orders": 9548, "delivered": 7356, "cancelled": 814, "returned": 490, "failed": 888, "delivery_rate": 77.0, "cancel_rate": 8.5}, {"Source": "Warehouse", "Year": 2025, "Month": 8, "total_orders": 8504, "delivered": 6724, "cancelled": 610, "returned": 370, "failed": 800, "delivery_rate": 79.1, "cancel_rate": 7.2}, {"Source": "Warehouse", "Year": 2025, "Month": 9, "total_orders": 16418, "delivered": 12340, "cancelled": 970, "returned": 970, "failed": 2130, "delivery_rate": 75.2, "cancel_rate": 5.9}, {"Source": "Warehouse", "Year": 2025, "Month": 10, "total_orders": 9108, "delivered": 6946, "cancelled": 444, "returned": 530, "failed": 1178, "delivery_rate": 76.3, "cancel_rate": 4.9}, {"Source": "Warehouse", "Year": 2025, "Month": 11, "total_orders": 14908, "delivered": 10936, "cancelled": 884, "returned": 734, "failed": 1686, "delivery_rate": 73.4, "cancel_rate": 5.9}];
        const allSources = ["Aeon Long Bi\u00ean", "Colum", "Crescent Mall", "Estella", "GO! Da Nang", "Le Van Sy", "Lotte Mall", "Shopee", "Warehouse"];
        let selectedSources = [...allSources];
        
        const sourceColors = {
            'Shopee': '#ee4d2d',
            'Website': '#4a90a4',
            'Lazada': '#0f146d',
            'Tiki': '#1a94ff',
            'default': '#6c5ce7'
        };
        
        const monthNames = ['', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const periods = [...new Set(metricsData.map(d => `${d.Year}-${d.Month}`))].sort().reverse();
        
        // Populate month selector
        const selector = document.getElementById('monthSelector');
        periods.forEach((p, i) => {
            const [year, month] = p.split('-').map(Number);
            const opt = document.createElement('option');
            opt.value = p;
            opt.textContent = `${monthNames[month]} ${year}`;
            if (i === 0) opt.selected = true;
            selector.appendChild(opt);
        });
        
        function renderSourceChips() {
            const container = document.getElementById('sourceChips');
            container.innerHTML = '';
            allSources.forEach(source => {
                const chip = document.createElement('div');
                chip.className = `chip ${selectedSources.includes(source) ? 'selected' : ''}`;
                chip.style.background = sourceColors[source] || sourceColors.default;
                chip.textContent = source;
                chip.onclick = () => toggleSource(source);
                container.appendChild(chip);
            });
        }
        
        function toggleSource(source) {
            if (selectedSources.includes(source)) {
                if (selectedSources.length > 1) selectedSources = selectedSources.filter(s => s !== source);
            } else {
                selectedSources.push(source);
            }
            renderSourceChips();
            updateDashboard();
        }
        
        function selectAllSources() {
            selectedSources = [...allSources];
            renderSourceChips();
            updateDashboard();
        }
        
        function getSourceData(source, year, month) {
            return metricsData.find(d => d.Source === source && d.Year === year && d.Month === month);
        }
        
        function fmt(n) { return n ? n.toLocaleString() : '0'; }
        
        function updateDashboard() {
            const [year, month] = selector.value.split('-').map(Number);
            const grid = document.getElementById('summaryGrid');
            grid.innerHTML = '';
            
            selectedSources.forEach(source => {
                const data = getSourceData(source, year, month);
                const color = sourceColors[source] || sourceColors.default;
                const card = document.createElement('div');
                card.className = 'metric-card';
                card.innerHTML = `
                    <h3 style="color: ${color}">${source} - ${monthNames[month]} ${year}</h3>
                    <div style="display: grid; gap: 10px; margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #888;">Total Orders</span>
                            <span style="font-weight: 600;">${data ? fmt(data.total_orders) : '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #888;">Delivery Rate</span>
                            <span class="positive" style="font-weight: 600;">${data ? data.delivery_rate + '%' : '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #888;">Cancel Rate</span>
                            <span class="negative" style="font-weight: 600;">${data ? data.cancel_rate + '%' : '-'}</span>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            
            updateCharts(year, month);
            updateComparisonTable(year, month);
        }
        
        function updateCharts(year, month) {
            // Trend chart
            const traces = selectedSources.map(source => {
                const sourceData = metricsData.filter(d => d.Source === source)
                    .sort((a, b) => a.Year !== b.Year ? a.Year - b.Year : a.Month - b.Month).slice(-12);
                return {
                    x: sourceData.map(d => `${monthNames[d.Month]} ${d.Year}`),
                    y: sourceData.map(d => d.total_orders),
                    type: 'scatter', mode: 'lines+markers', name: source,
                    line: {color: sourceColors[source] || sourceColors.default, width: 3}
                };
            });
            
            Plotly.newPlot('trendChart', traces, {
                paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)',
                font: {color: '#888'}, margin: {t: 20, r: 20, b: 60, l: 60},
                xaxis: {gridcolor: 'rgba(255,255,255,0.1)', tickangle: -45},
                yaxis: {gridcolor: 'rgba(255,255,255,0.1)', title: 'Orders'},
                legend: {orientation: 'h', y: 1.1}
            }, {responsive: true});
            
            // Comparison chart
            const metrics = ['Total Orders', 'Delivered', 'Cancelled', 'Returned'];
            const barTraces = selectedSources.map(source => {
                const data = getSourceData(source, year, month);
                return {
                    x: metrics,
                    y: data ? [data.total_orders, data.delivered, data.cancelled, data.returned] : [0,0,0,0],
                    type: 'bar', name: source,
                    marker: {color: sourceColors[source] || sourceColors.default}
                };
            });
            
            Plotly.newPlot('comparisonChart', barTraces, {
                paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)',
                font: {color: '#888'}, margin: {t: 20, r: 20, b: 40, l: 60},
                barmode: 'group', legend: {orientation: 'h', y: 1.15},
                yaxis: {gridcolor: 'rgba(255,255,255,0.1)'}
            }, {responsive: true});
        }
        
        function updateComparisonTable(year, month) {
            const table = document.getElementById('comparisonTable');
            const thead = table.querySelector('thead tr');
            const tbody = table.querySelector('tbody');
            
            thead.innerHTML = '<th>Metric</th>' + selectedSources.map(s => 
                `<th style="color: ${sourceColors[s] || sourceColors.default}">${s}</th>`
            ).join('');
            
            const sourceData = selectedSources.map(s => getSourceData(s, year, month) || {});
            const rows = [
                {label: 'Total Orders', key: 'total_orders', best: 'max'},
                {label: 'Delivered', key: 'delivered', best: 'max'},
                {label: 'Delivery Rate', key: 'delivery_rate', best: 'max', suffix: '%'},
                {label: 'Cancelled', key: 'cancelled', best: 'min'},
                {label: 'Cancel Rate', key: 'cancel_rate', best: 'min', suffix: '%'},
                {label: 'Returned', key: 'returned', best: 'min'},
            ];
            
            tbody.innerHTML = rows.map(row => {
                const values = sourceData.map(d => d[row.key] || 0);
                const best = row.best === 'max' ? Math.max(...values) : Math.min(...values.filter(v => v > 0));
                return `<tr><td>${row.label}</td>${values.map(v => 
                    `<td class="${v === best && v > 0 ? 'best' : ''}">${fmt(v)}${row.suffix || ''}</td>`
                ).join('')}</tr>`;
            }).join('');
        }
        
        renderSourceChips();
        updateDashboard();
    </script>
</body>
</html>

